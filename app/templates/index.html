<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery-DL Web</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .card { margin-top: 50px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="card-title text-center mb-4">Gallery-DL Downloader</h1>
                        <p class="text-center text-muted mb-4">Enter a gallery URL to download, compress, and upload to your preferred storage.</p>

                        <form action="/download" method="post" id="download-form">
                            <div class="mb-3">
                                <label for="url" class="form-label">Gallery URL</label>
                                <input type="url" class="form-control" id="url" name="url" required placeholder="e.g., https://www.deviantart.com/username/gallery/all">
                            </div>

                            <div class="accordion" id="accordion-credentials">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                            Advanced Options (DeviantArt Credentials)
                                        </button>
                                    </h2>
                                    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordion-credentials">
                                        <div class="accordion-body">
                                            <p class="text-muted small">Provide your own DeviantArt API credentials to avoid rate limits. <a href="https://gdl-org.github.io/docs/configuration.html#extractor-deviantart-client-id-client-secret" target="_blank">How to get them?</a></p>
                                            <div class="mb-3">
                                                <label for="deviantart_client_id" class="form-label">Client ID</label>
                                                <input type="text" class="form-control" id="deviantart_client_id" name="deviantart_client_id">
                                            </div>
                                            <div class="mb-3">
                                                <label for="deviantart_client_secret" class="form-label">Client Secret</label>
                                                <input type="password" class="form-control" id="deviantart_client_secret" name="deviantart_client_secret">
                                            </div>
                                            <hr>
                                            <p class="text-muted small">Use a proxy to bypass IP blocks (e.g., from CloudFront).</p>
                                            <div class="mb-3">
                                                <label for="proxy" class="form-label">Proxy URL</label>
                                                <input type="text" class="form-control" id="proxy" name="proxy" placeholder="e.g., http://user:pass@host:port">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <h3 class="h5 mb-3">Upload Configuration</h3>

                            <div class="mb-3">
                                <label for="upload_service" class="form-label">Upload Service</label>
                                <select class="form-select" id="upload_service" name="upload_service" onchange="showConfig()" required>
                                    <option value="">-- Select a Service --</option>
                                    <option value="webdav">WebDAV</option>
                                    <option value="s3">S3 Compatible</option>
                                    <option value="b2">Backblaze B2</option>
                                    <option value="gofile">gofile.io</option>
                                </select>
                            </div>

                            <div id="upload-path-container" class="mb-3">
                                <label for="upload_path" class="form-label">Remote Upload Path/Bucket</label>
                                <input type="text" class="form-control" id="upload_path" name="upload_path" placeholder="e.g., my-bucket/archives">
                            </div>

                            <!-- Service-specific configs -->
                            <div id="service-configs">
                                <div id="config-webdav" class="service-config card card-body mb-3" style="display:none;">
                                    <h5>WebDAV Settings</h5>
                                    <div class="mb-3">
                                        <label for="webdav_url" class="form-label">WebDAV URL</label>
                                        <input type="url" class="form-control" id="webdav_url" name="webdav_url" placeholder="e.g., https://your-server.com/remote.php/dav/files/username">
                                    </div>
                                    <div class="mb-3">
                                        <label for="webdav_user" class="form-label">WebDAV Username</label>
                                        <input type="text" class="form-control" id="webdav_user" name="webdav_user">
                                    </div>
                                    <div class="mb-3">
                                        <label for="webdav_pass" class="form-label">WebDAV Password</label>
                                        <input type="password" class="form-control" id="webdav_pass" name="webdav_pass">
                                    </div>
                                </div>

                                <div id="config-s3" class="service-config card card-body mb-3" style="display:none;">
                                    <h5>S3 Settings</h5>
                                    <div class="mb-3">
                                        <label for="s3_provider" class="form-label">S3 Provider</label>
                                        <input type="text" class="form-control" id="s3_provider" name="s3_provider" placeholder="AWS">
                                    </div>
                                    <div class="mb-3">
                                        <label for="s3_access_key_id" class="form-label">Access Key ID</label>
                                        <input type="text" class="form-control" id="s3_access_key_id" name="s3_access_key_id">
                                    </div>
                                    <div class="mb-3">
                                        <label for="s3_secret_access_key" class="form-label">Secret Access Key</label>
                                        <input type="password" class="form-control" id="s3_secret_access_key" name="s3_secret_access_key">
                                    </div>
                                    <div class="mb-3">
                                        <label for="s3_region" class="form-label">Region</label>
                                        <input type="text" class="form-control" id="s3_region" name="s3_region" placeholder="us-east-1">
                                    </div>
                                    <div class="mb-3">
                                        <label for="s3_endpoint" class="form-label">Endpoint URL (optional)</label>
                                        <input type="url" class="form-control" id="s3_endpoint" name="s3_endpoint" placeholder="e.g., https://s3.custom.com">
                                    </div>
                                </div>

                                <div id="config-b2" class="service-config card card-body mb-3" style="display:none;">
                                    <h5>Backblaze B2 Settings</h5>
                                    <div class="mb-3">
                                        <label for="b2_account_id" class="form-label">Account ID or Application Key ID</label>
                                        <input type="text" class="form-control" id="b2_account_id" name="b2_account_id">
                                    </div>
                                    <div class="mb-3">
                                        <label for="b2_application_key" class="form-label">Application Key</label>
                                        <input type="password" class="form-control" id="b2_application_key" name="b2_application_key">
                                    </div>
                                </div>

                                <div id="config-gofile" class="service-config card card-body mb-3" style="display:none;">
                                    <h5>gofile.io Settings</h5>
                                    <div class="mb-3">
                                        <label for="gofile_token" class="form-label">API Token (optional)</label>
                                        <input type="password" class="form-control" id="gofile_token" name="gofile_token">
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg" id="submit-button">
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                                    Start Download
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="text-center mt-3 footer">
                    <p class="text-muted small">Powered by gallery-dl, FastAPI, rclone, and zstd.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showConfig() {
            const selectedService = document.getElementById('upload_service').value;
            document.querySelectorAll('.service-config').forEach(div => {
                div.style.display = 'none';
            });
            if (selectedService) {
                const activeDiv = document.getElementById('config-' + selectedService);
                if (activeDiv) {
                    activeDiv.style.display = 'block';
                }
            }

            const uploadPathContainer = document.getElementById('upload-path-container');
            if (selectedService === 'gofile') {
                uploadPathContainer.style.display = 'none';
                document.getElementById('upload_path').required = false;
            } else {
                uploadPathContainer.style.display = 'block';
                document.getElementById('upload_path').required = true;
            }
        }

        document.getElementById('download-form').addEventListener('submit', function() {
            const button = document.getElementById('submit-button');
            const spinner = button.querySelector('.spinner-border');
            button.disabled = true;
            spinner.style.display = 'inline-block';
        });

        // Initialize on page load
        showConfig();
    </script>
</body>
</html>