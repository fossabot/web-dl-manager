<!DOCTYPE html>
<html lang="{{ lang.get('lang_code', 'en') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ lang.settings_title }} - {{ lang.app_title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .settings-header {
            margin-bottom: 2rem;
            padding: 0 0.5rem;
        }
        .accordion-item {
            border: none;
            background: none;
            margin-bottom: 1.5rem;
        }
        .accordion-button {
            border-radius: 12px !important;
            background-color: white;
            box-shadow: var(--shadow-sm);
            padding: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }
        .accordion-button:not(.collapsed) {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.2);
        }
        .accordion-button::after {
            background-size: 1rem;
        }
        .accordion-button:not(.collapsed)::after {
            filter: brightness(0) invert(1);
        }
        .accordion-body {
            background-color: white;
            margin-top: 0.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
        }
        .sync-task-item {
            border: 1px solid rgba(0,0,0,0.05);
            background-color: #fcfcfc;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }
        .form-label {
            font-weight: 500;
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 0.4rem;
        }
        .form-control, .form-select {
            border-radius: 8px;
            padding: 0.6rem 0.8rem;
            border: 1px solid #e2e8f0;
        }
        .maintenance-section {
            margin-top: 3rem;
            padding: 2rem 1rem;
            border-top: 1px solid #e2e8f0;
        }
        /* Mobile fixes */
        @media (max-width: 768px) {
            .container-main {
                padding: 1rem;
            }
            .accordion-body {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    {% include 'components/navbar.html' %}
    
    <div class="container-main">
        <div class="settings-header">
            <h1 class="h3"><i class="bi bi-gear-fill me-2 text-primary"></i>{{ lang.system_settings_title }}</h1>
            <p class="text-muted small">Manage your application configuration and storage services.</p>
        </div>

        {% if success %}
        <div class="alert alert-success alert-dismissible fade show border-0 shadow-sm mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i> {{ success }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show border-0 shadow-sm mb-4" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <form action="/settings" method="POST" id="settings-form">
            <div class="accordion" id="settingsAccordion">
                
                <!-- Section 1: General Settings -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGeneral">
                            <i class="bi bi-sliders me-3"></i> {{ lang.general_settings_section }}
                        </button>
                    </h2>
                    <div id="collapseGeneral" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.cloudflared_token_label }}</label>
                                    <input type="text" class="form-control" name="TUNNEL_TOKEN" value="{{ config.TUNNEL_TOKEN }}">
                                    <div class="form-text x-small">{{ lang.cloudflared_token_text }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.login_domain_label }}</label>
                                    <input type="text" class="form-control" name="login_domain" value="{{ config.login_domain }}">
                                    <div class="form-text x-small">{{ lang.login_domain_text }}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.avatar_url_label }}</label>
                                    <input type="text" class="form-control" name="AVATAR_URL_INPUT" value="{{ config.AVATAR_URL }}">
                                    <div class="form-text x-small">{{ lang.avatar_url_text }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.github_token_label }}</label>
                                    <input type="password" class="form-control" name="GITHUB_TOKEN" value="{{ config.GITHUB_TOKEN }}">
                                    <div class="form-text x-small">{{ lang.github_token_text }}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.private_mode_label }}</label>
                                    <select class="form-select" name="PRIVATE_MODE">
                                        <option value="true" {% if config.PRIVATE_MODE == 'true' %}selected{% endif %}>True</option>
                                        <option value="false" {% if config.PRIVATE_MODE != 'true' %}selected{% endif %}>False</option>
                                    </select>
                                    <div class="form-text x-small">{{ lang.private_mode_text }}</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.get('terminal_enabled_config_label', 'Terminal Enabled') }}</label>
                                    <select class="form-select" name="TERMINAL_ENABLED">
                                        <option value="true" {% if config.TERMINAL_ENABLED == 'true' %}selected{% endif %}>True</option>
                                        <option value="false" {% if config.TERMINAL_ENABLED != 'true' %}selected{% endif %}>False</option>
                                    </select>
                                    <div class="form-text x-small">{{ lang.terminal_enabled_text }}</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.debug_mode_label }}</label>
                                    <select class="form-select" name="DEBUG_MODE">
                                        <option value="true" {% if config.DEBUG_MODE == 'true' %}selected{% endif %}>True</option>
                                        <option value="false" {% if config.DEBUG_MODE != 'true' %}selected{% endif %}/False</option>
                                    </select>
                                    <div class="form-text x-small">{{ lang.debug_mode_text }}</div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">{{ lang.gallery_dl_args_label }}</label>
                                <input type="text" class="form-control" name="WDM_GALLERY_DL_ARGS" value="{{ config.WDM_GALLERY_DL_ARGS }}" placeholder="{{ lang.gallery_dl_args_placeholder }}">
                                <div class="form-text x-small">{{ lang.gallery_dl_args_text }}</div>
                            </div>
                            <div class="mb-0">
                                <label class="form-label">{{ lang.redis_url_label }}</label>
                                <input type="text" class="form-control" name="REDIS_URL" value="{{ config.REDIS_URL }}">
                                <div class="form-text x-small">{{ lang.redis_url_text }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Storage Services -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStorage">
                            <i class="bi bi-cloud-arrow-up me-3"></i> {{ lang.storage_services_section }}
                        </button>
                    </h2>
                    <div id="collapseStorage" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                        <div class="accordion-body">
                            <!-- Minimal titles, no extra boxes -->
                            <h6 class="fw-bold mb-3 mt-2 text-primary small uppercase">WebDAV</h6>
                            <div class="mb-3"><input type="text" class="form-control" name="WDM_WEBDAV_URL" value="{{ config.WDM_WEBDAV_URL }}" placeholder="URL"></div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_WEBDAV_USER" value="{{ config.WDM_WEBDAV_USER }}" placeholder="User"></div>
                                <div class="col-md-6 mb-2"><input type="password" class="form-control" name="WDM_WEBDAV_PASS" value="{{ config.WDM_WEBDAV_PASS }}" placeholder="Pass"></div>
                            </div>

                            <h6 class="fw-bold mb-3 border-top pt-4 text-primary small uppercase">S3 Compatible</h6>
                            <div class="row mb-3">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_S3_PROVIDER" value="{{ config.WDM_S3_PROVIDER }}" placeholder="Provider"></div>
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_S3_REGION" value="{{ config.WDM_S3_REGION }}" placeholder="Region"></div>
                            </div>
                            <div class="mb-3"><input type="text" class="form-control" name="WDM_S3_ENDPOINT" value="{{ config.WDM_S3_ENDPOINT }}" placeholder="Endpoint URL"></div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_S3_ACCESS_KEY_ID" value="{{ config.WDM_S3_ACCESS_KEY_ID }}" placeholder="Access Key ID"></div>
                                <div class="col-md-6 mb-2"><input type="password" class="form-control" name="WDM_S3_SECRET_ACCESS_KEY" value="{{ config.WDM_S3_SECRET_ACCESS_KEY }}" placeholder="Secret Key"></div>
                            </div>

                            <h6 class="fw-bold mb-3 border-top pt-4 text-primary small uppercase">Backblaze B2</h6>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_B2_ACCOUNT_ID" value="{{ config.WDM_B2_ACCOUNT_ID }}" placeholder="Account ID"></div>
                                <div class="col-md-6 mb-2"><input type="password" class="form-control" name="WDM_B2_APPLICATION_KEY" value="{{ config.WDM_B2_APPLICATION_KEY }}" placeholder="Application Key"></div>
                            </div>

                            <h6 class="fw-bold mb-3 border-top pt-4 text-primary small uppercase">Gofile.io</h6>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_GOFILE_TOKEN" value="{{ config.WDM_GOFILE_TOKEN }}" placeholder="API Token"></div>
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_GOFILE_FOLDER_ID" value="{{ config.WDM_GOFILE_FOLDER_ID }}" placeholder="Folder ID"></div>
                            </div>

                            <h6 class="fw-bold mb-3 border-top pt-4 text-primary small uppercase">Openlist</h6>
                            <div class="mb-2"><input type="text" class="form-control" name="WDM_OPENLIST_URL" value="{{ config.WDM_OPENLIST_URL }}" placeholder="API URL"></div>
                            <div class="row">
                                <div class="col-md-6 mb-2"><input type="text" class="form-control" name="WDM_OPENLIST_USER" value="{{ config.WDM_OPENLIST_USER }}" placeholder="User"></div>
                                <div class="col-md-6 mb-2"><input type="password" class="form-control" name="WDM_OPENLIST_PASS" value="{{ config.WDM_OPENLIST_PASS }}" placeholder="Pass"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Rclone Backup -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBackup">
                            <i class="bi bi-shield-lock me-3"></i> {{ lang.backup_settings_section }}
                        </button>
                    </h2>
                    <div id="collapseBackup" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <label class="form-label text-primary">{{ lang.rclone_raw_config_label }}</label>
                                <textarea class="form-control" id="RCLONE_RAW_CONFIG" rows="3" placeholder="{{ lang.rclone_raw_config_placeholder }}"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">{{ lang.backup_rclone_base64_label }}</label>
                                <textarea class="form-control" id="WDM_CONFIG_BACKUP_RCLONE_BASE64" name="WDM_CONFIG_BACKUP_RCLONE_BASE64" rows="3">{{ config.WDM_CONFIG_BACKUP_RCLONE_BASE64 }}</textarea>
                            </div>
                            <div class="mb-0">
                                <label class="form-label">{{ lang.backup_remote_path_label }}</label>
                                <input type="text" class="form-control" name="WDM_CONFIG_BACKUP_REMOTE_PATH" value="{{ config.WDM_CONFIG_BACKUP_REMOTE_PATH }}">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Scheduled Sync -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSync">
                            <i class="bi bi-clock-history me-3"></i> {{ lang.custom_sync_settings_section }}
                        </button>
                    </h2>
                    <div id="collapseSync" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                        <div class="accordion-body">
                            <div id="sync-tasks-container"></div>
                            <div class="mt-3">
                                <button type="button" class="btn btn-outline-primary btn-sm rounded-pill px-3" id="add-sync-task-btn">
                                    <i class="bi bi-plus-circle me-1"></i> {{ lang.sync_add_task_button }}
                                </button>
                            </div>
                            <input type="hidden" name="WDM_SYNC_TASKS_JSON" id="WDM_SYNC_TASKS_JSON">
                        </div>
                    </div>
                </div>

                <!-- Section 5: Verification -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVerify">
                            <i class="bi bi-shield-check me-3"></i> {{ lang.verification_settings_section }}
                        </button>
                    </h2>
                    <div id="collapseVerify" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <label class="form-label">{{ lang.verification_type_label }}</label>
                                <select class="form-select" name="WDM_VERIFICATION_TYPE">
                                    <option value="none" {% if config.WDM_VERIFICATION_TYPE == 'none' %}selected{% endif %}>{{ lang.verification_none }}</option>
                                    <option value="local" {% if config.WDM_VERIFICATION_TYPE == 'local' %}selected{% endif %}>{{ lang.verification_local }}</option>
                                    <option value="cloudflare" {% if config.WDM_VERIFICATION_TYPE == 'cloudflare' %}selected{% endif %}>{{ lang.verification_cloudflare }}</option>
                                    <option value="google" {% if config.WDM_VERIFICATION_TYPE == 'google' %}selected{% endif %}>{{ lang.verification_google }}</option>
                                    <option value="geetest" {% if config.WDM_VERIFICATION_TYPE == 'geetest' %}selected{% endif %}>{{ lang.verification_geetest }}</option>
                                </select>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-truncate">{{ lang.verification_site_key_label }}</label>
                                    <input type="text" class="form-control" name="WDM_VERIFICATION_SITE_KEY" value="{{ config.WDM_VERIFICATION_SITE_KEY }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-truncate">{{ lang.verification_secret_key_label }}</label>
                                    <input type="password" class="form-control" name="WDM_VERIFICATION_SECRET_KEY" value="{{ config.WDM_VERIFICATION_SECRET_KEY }}">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label text-truncate">{{ lang.verification_id_label }}</label>
                                    <input type="text" class="form-control" name="WDM_VERIFICATION_ID" value="{{ config.WDM_VERIFICATION_ID }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">{{ lang.verification_geetest_demo_type_label }}</label>
                                    <select class="form-select" name="WDM_VERIFICATION_GEETEST_DEMO_TYPE">
                                        <option value="slide" {% if config.WDM_VERIFICATION_GEETEST_DEMO_TYPE == 'slide' %}selected{% endif %}>{{ lang.geetest_type_slide }}</option>
                                        <option value="click" {% if config.WDM_VERIFICATION_GEETEST_DEMO_TYPE == 'click' %}selected{% endif %}>{{ lang.geetest_type_click }}</option>
                                        <option value="fullpage" {% if config.WDM_VERIFICATION_GEETEST_DEMO_TYPE == 'fullpage' %}selected{% endif %}>{{ lang.geetest_type_fullpage }}</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-5 pb-5">
                <a href="/downloader" class="btn btn-outline-secondary me-md-2 rounded-pill px-4">{{ lang.back_to_downloader }}</a>
                <button type="submit" class="btn btn-primary rounded-pill px-5" id="save-settings-btn">
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true" style="display: none;"></span>
                    <span class="btn-text"><i class="bi bi-save me-2"></i> {{ lang.save_settings_button }}</span>
                </button>
            </div>
        </form>

        <!-- Separate simple boxes for cleanup -->
        <div class="maintenance-section">
            <div class="row">
                <div class="col-md-6 mb-4">
                    <h5 class="h6 fw-bold mb-3"><i class="bi bi-lightning-charge me-2"></i>{{ lang.cache_clearing_label }}</h5>
                    <p class="text-muted small mb-3">{{ lang.cache_clearing_text }}</p>
                    <button id="clear-cache-btn" class="btn btn-outline-warning btn-sm rounded-pill px-3">
                        <i class="bi bi-trash me-1"></i> {{ lang.clear_cache_button }}
                    </button>
                    <div id="cache-status" class="mt-2 small"></div>
                </div>
                <div class="col-md-6 mb-4">
                    <h5 class="h6 fw-bold mb-3"><i class="bi bi-database-gear me-2"></i>{{ lang.db_maintenance_label }}</h5>
                    <p class="text-muted small mb-3">{{ lang.db_maintenance_text }}</p>
                    <button id="cleanup-db-btn" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                        <i class="bi bi-eraser me-1"></i> {{ lang.cleanup_db_button }}
                    </button>
                    <div id="db-status" class="mt-2 small"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- Sync Task Management ---
        let syncTasks = [];
        try {
            const rawJson = `{{ config.WDM_SYNC_TASKS_JSON | safe }}`;
            syncTasks = JSON.parse(rawJson || '[]');
        } catch (e) {
            syncTasks = [];
        }

        function renderTasks() {
            const container = document.getElementById('sync-tasks-container');
            if (syncTasks.length === 0) {
                container.innerHTML = `<p class="text-muted small italic">{{ lang.sync_no_tasks_text }}</p>`;
                return;
            }
            container.innerHTML = '';
            syncTasks.forEach((task, index) => {
                const item = document.createElement('div');
                item.className = 'sync-task-item';
                item.innerHTML = `
                    <div class="row align-items-center mb-2">
                        <div class="col-8 col-md-10">
                            <input type="text" class="form-control form-control-sm fw-bold border-0 bg-transparent p-0" value="${task.name || ''}" onchange="updateTask(${index}, 'name', this.value)" placeholder="{{ lang.sync_task_name_label }}">
                        </div>
                        <div class="col-4 col-md-2 text-end">
                            <button type="button" class="btn btn-link text-danger btn-sm p-0" onclick="removeTask(${index})"><i class="bi bi-trash"></i></button>
                        </div>
                    </div>
                    <div class="row g-2">
                        <div class="col-md-5">
                            <label class="form-label small mb-1">{{ lang.custom_sync_local_path_label }}</label>
                            <input type="text" class="form-control form-control-sm" value="${task.local_path || ''}" onchange="updateTask(${index}, 'local_path', this.value)">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label small mb-1">{{ lang.custom_sync_remote_path_label }}</label>
                            <input type="text" class="form-control form-control-sm" value="${task.remote_path || ''}" onchange="updateTask(${index}, 'remote_path', this.value)">
                        </div>
                        <div class="col-md-2">
                            <label class="form-label small mb-1">{{ lang.custom_sync_interval_label }} (Min)</label>
                            <input type="number" class="form-control form-control-sm" value="${task.interval || 60}" onchange="updateTask(${index}, 'interval', parseInt(this.value))">
                        </div>
                    </div>
                    <div class="form-check form-switch mt-2">
                        <input class="form-check-input" type="checkbox" ${task.enabled ? 'checked' : ''} onchange="updateTask(${index}, 'enabled', this.checked)">
                        <label class="form-check-label small">{{ lang.custom_sync_enabled_label }}</label>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateTask(index, field, value) { syncTasks[index][field] = value; }
        function removeTask(index) { if (confirm("{{ lang.sync_delete_confirm }}")) { syncTasks.splice(index, 1); renderTasks(); } }
        document.getElementById('add-sync-task-btn').addEventListener('click', () => {
            syncTasks.push({ name: "New Sync Task", local_path: "", remote_path: "", interval: 60, enabled: true });
            renderTasks();
        });
        renderTasks();

        // Rclone Raw to Base64
        document.getElementById('RCLONE_RAW_CONFIG').addEventListener('input', function() {
            const rawValue = this.value.trim();
            if (rawValue) {
                try {
                    document.getElementById('WDM_CONFIG_BACKUP_RCLONE_BASE64').value = btoa(unescape(encodeURIComponent(rawValue)));
                } catch (e) { console.error(e); }
            }
        });

        // Form submit
        document.getElementById('settings-form').addEventListener('submit', function() {
            document.getElementById('WDM_SYNC_TASKS_JSON').value = JSON.stringify(syncTasks);
            const btn = document.getElementById('save-settings-btn');
            btn.disabled = true;
            btn.querySelector('.spinner-border').style.display = 'inline-block';
            btn.querySelector('.btn-text').textContent = '{{ lang.processing }}';
        });

        // Cleanup buttons
        async function handleCleanup(btnId, statusId, endpoint) {
            const btn = document.getElementById(btnId);
            const status = document.getElementById(statusId);
            const originalHtml = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span> {{ lang.cleaning_placeholder }}';
            try {
                const res = await fetch(endpoint, { method: 'POST' });
                                if (res.ok) {
                                    status.className = 'mt-2 small text-success';
                                    status.innerHTML = '<i class="bi bi-check-circle"></i> {{ lang.cache_cleared_success if lang.cache_cleared_success else "Success" }}';
                                    setTimeout(() => status.innerHTML = '', 3000);
                                }
                            } catch (e) {
                                status.className = 'mt-2 small text-danger';
                                status.innerHTML = '<i class="bi bi-exclamation-circle"></i> {{ lang.error_prefix if lang.error_prefix else "Error" }}';
                            }
                 finally {
                btn.disabled = false;
                btn.innerHTML = originalHtml;
            }
        }
        document.getElementById('clear-cache-btn').addEventListener('click', () => handleCleanup('clear-cache-btn', 'cache-status', '/api/cache/clear'));
        document.getElementById('cleanup-db-btn').addEventListener('click', () => handleCleanup('cleanup-db-btn', 'db-status', '/api/database/cleanup'));
    </script>
</body>
</html>
